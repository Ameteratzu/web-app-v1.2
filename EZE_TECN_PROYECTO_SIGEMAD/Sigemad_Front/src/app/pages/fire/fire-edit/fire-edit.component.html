<div fxLayout="column" fxLayoutGap="16px" class="filter-container">
  <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch">
    <mat-form-field appearance="fill" fxFlex="25">
      <mat-label>Denominación</mat-label>
      <input matInput [formControl]="getForm('denomination')" />
    </mat-form-field>

    <mat-form-field appearance="fill" fxFlex="25">
      <mat-label>Municipio</mat-label>
      <input matInput [formControl]="getForm('ubicacion')" />
    </mat-form-field>

    <img
      (click)="openModalMap()"
      matSuffix
      src="/assets/img/location-btn.svg"
      alt="location-btn"
      class="pin-location"
      matTooltip="Mapa de situación"
    />

    <!--
    <mat-form-field appearance="fill" fxFlex="20">
      <mat-label>Clase de suceso</mat-label>
      <input matInput [formControl]="getForm('suceso')" />
    </mat-form-field>
    -->

    <mat-form-field appearance="fill" fxFlex="25">
      <mat-label>Fecha de inicio</mat-label>
      <input matInput [formControl]="getForm('startDate')" />
    </mat-form-field>

    <mat-form-field appearance="fill" fxFlex="25">
      <mat-label>Estado del suceso</mat-label>
      <input matInput [formControl]="getForm('estado')" />
    </mat-form-field>
  </div>

  <!-- PCD -->
  <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch">
    <mat-form-field appearance="fill" fxFlex="100">
      <mat-label>Nota general</mat-label>
      <input matInput [formControl]="getForm('generalNote')" />
    </mat-form-field>
  </div>
  <!-- FIN PCD -->

  <div fxLayout="row" fxLayoutAlign="space-between center">
    <div>
      <!--<button (click)="deleteFire()" mat-flat-button [style.background-color]="'var(--fire-color)'">Eliminar</button>-->

      <!-- PCD-->
      <a (click)="refrescarDatos()" style="cursor: pointer" matTooltip="Refrescar datos">
        <img src="/assets/img/refresh.svg" alt="Refrescar" style="width: 30px; position: relative; top: 10px; margin-right: 5px" />
      </a>
      <button (click)="goModalEditFire()" mat-flat-button [style.background-color]="'var(--fire-color)'" style="margin-right: 5px">Editar</button>
      <button
        (click)="deleteFire()"
        mat-flat-button
        [style.background-color]="dataSource.data.length > 0 ? 'grey' : 'var(--fire-color)'"
        [disabled]="dataSource.data.length > 0"
      >
        Eliminar
      </button>
      <!-- FIN PCD-->
    </div>

    <div fxLayout="row" fxLayoutGap="16px">
      <button mat-flat-button color="accent" (click)="volver()">Volver</button>
    </div>
  </div>
</div>
<br />

<!-- GRÁFICO HISTÓRICO -->
<app-fire-grafico-historico [dataSource]="dataSource" />
<!-- FIN GRÁFICO HISTÓRICO -->

<br />

<div fxLayout="row" fxLayoutAlign="start stretch" fxLayoutGap="16px" style="height: 100%">
  <div fxFlex="30" class="info-section">
    <mat-card>
      <mat-card-title>Situación Evolutiva</mat-card-title>
      <mat-card-content>
        <p>
          <strong>Inicio de incendio:</strong>
          19/08/2024 19:45
        </p>
        <p>
          <strong>Estado:</strong>
          Activo
        </p>
        <p>
          <strong>Nivel de gravedad:</strong>
          Activo
        </p>
        <mat-divider></mat-divider>

        <h4>Hechos relevantes</h4>
        <p>Activado plan nacional XX (18/08/2024 10:00)</p>
        <p>Activado Copernico (18/08/2024 12:00)</p>
        <p>CECOPI (19/08/2024 18:15)</p>
        <mat-divider></mat-divider>

        <h4>Consecuencias</h4>
        <p>Heridos: 2</p>
        <p>Evacuados: 134 (Santa María - 18/08/2024 19:45)</p>
        <p>Área afectada: Santa María de Guía de Gran Canaria</p>
        <p>Viabilidad: Corte CN-21 PK 2,300-3,100</p>
        <mat-divider></mat-divider>

        <h4>Medios intervinientes</h4>
        <p>BRIF/A - Tineo (18/08/2024 12:40)</p>
        <p>FOCA - Torrejón (18/08/2024 16:35)</p>
        <p>UME - Aprobación (19/08/2024 19:45)</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex="70" class="table-section">
    <mat-card>
      <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="16px">
        <mat-card-title>Registro de actualizaciones</mat-card-title>

        <div fxLayout="row" fxLayoutGap="8px" class="btn-container">
          <button mat-button class="circle-button" (click)="goModalEvolution()" appTooltip="Datos evolutivos">E</button>
          <button mat-button class="circle-button" (click)="goModalCoordination()" appTooltip="Dirección y coordinación">C</button>
          <button mat-button class="circle-button" (click)="goModalRelevantActions()" appTooltip="Actuaciones relevantes">R</button>
          <button mat-button class="circle-button" (click)="goModalDocumentation()" appTooltip="Documentación">D</button>
          <button mat-button class="circle-button" (click)="goModalOtherInformation()" appTooltip="Otra información">O</button>
          <button mat-button class="circle-button" (click)="goModalRelatedEvent()" appTooltip="Sucesos relacionados">S</button>
        </div>
      </div>
      <br />
      <mat-card-content *ngIf="dataSource.data.length > 0">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" style="width: 100%">
          <ng-container matColumnDef="numero">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-center" sortActionDescription="Sort by numero">N°</th>
            <td mat-cell *matCellDef="let element; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>

          <ng-container matColumnDef="fechaHora">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by fechaHora">Fecha / hora</th>
            <td mat-cell *matCellDef="let element">
              {{ getFormatdate(element.fechaHora) }}
            </td>
          </ng-container>

          <ng-container matColumnDef="tipoRegistro">
            <th sortActionDescription="Sort by tipoRegistro" mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de registro</th>
            <td mat-cell *matCellDef="let element">
              {{ element.tipoRegistro.nombre }}
            </td>
          </ng-container>

          <ng-container matColumnDef="apartados">
            <th sortActionDescription="Sort by apartados" mat-header-cell *matHeaderCellDef mat-sort-header>Apartados</th>
            <td mat-cell *matCellDef="let element">{{ element.apartados }}</td>
          </ng-container>

          <ng-container matColumnDef="tecnico">
            <th sortActionDescription="Sort by tecnico" mat-header-cell *matHeaderCellDef mat-sort-header class="text-center">Técnico</th>
            <td mat-cell *matCellDef="let element" class="text-center">{{ element.tecnico }}</td>
          </ng-container>

          <ng-container matColumnDef="opciones">
            <th mat-header-cell *matHeaderCellDef style="text-align: center">Opciones</th>
            <td mat-cell *matCellDef="let fire" style="text-align: center">
              <a (click)="goModalEdit(fire)">
                <img src="/assets/img/edit.svg" alt="Editar" appTooltip="Editar registro" />
              </a>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-atom" [fullScreen]="true">
  <p style="color: white">Cargando...</p>
</ngx-spinner>
