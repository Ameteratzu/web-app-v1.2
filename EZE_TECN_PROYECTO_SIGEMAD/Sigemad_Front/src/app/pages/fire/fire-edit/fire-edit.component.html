<div fxLayout="column" fxLayoutGap="16px" class="filter-container">
  <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch">
    <mat-form-field appearance="fill" fxFlex="20">
      <mat-label>Denominación</mat-label>
      <input matInput [formControl]="getForm('denomination')" />
    </mat-form-field>

    <mat-form-field appearance="fill" fxFlex="20">
      <mat-label>Ubicación</mat-label>
      <input matInput [formControl]="getForm('ubicacion')" />
    </mat-form-field>

    <img (click)="openModalMap()" matSuffix src="/assets/img/location-btn.svg" alt="location-btn" class="pin-location" />

    <mat-form-field appearance="fill" fxFlex="20">
      <mat-label>Clase de suceso</mat-label>
      <input matInput [formControl]="getForm('suceso')" />
    </mat-form-field>

    <mat-form-field appearance="fill" fxFlex="20">
      <mat-label>Fecha de inicio</mat-label>
      <input matInput [formControl]="getForm('startDate')" />
    </mat-form-field>

    <mat-form-field appearance="fill" fxFlex="20">
      <mat-label>Estado del suceso</mat-label>
      <input matInput [formControl]="getForm('estado')" />
    </mat-form-field>
  </div>

  <div fxLayout="row" fxLayoutAlign="space-between center">
    <div>
      <button (click)="deleteFire()" mat-flat-button [style.background-color]="'var(--fire-color)'">Eliminar</button>
    </div>

    <div fxLayout="row" fxLayoutGap="16px">
      <button mat-flat-button color="accent" (click)="volver()">Volver</button>
    </div>
  </div>
</div>
<br />
<div fxLayout="column" fxLayoutGap="16px" class="filter-container">
  <!--<img class="w-100" src="/assets/img/graph.svg" alt="graph" />-->

  <!-- PCD-->
  <div class="tabla-contenedor-historico">
    <!-- Leyenda con solo iconos a la izquierda -->
    <div class="leyenda" style="margin-top: 52px">
      <ng-container *ngIf="filaNivelSituacionOperativaEquivalente.size > 0">
        <div class="leyenda-item">
          <img src="/assets/assets/img/DGPCE_logo.png" style="width: 15px" />
        </div>
      </ng-container>
      <ng-container *ngIf="filaAfectaciones.size > 0">
        <div class="leyenda-item">
          <img src="/assets/assets/img/consecuencias.png" style="width: 15px" />
        </div>
      </ng-container>
      <ng-container *ngIf="filaMediosExtincionOrdinarios.size > 0">
        <div class="leyenda-item">
          <img src="/assets/assets/img/hidroavion.png" style="width: 15px" />
        </div>
      </ng-container>
      <ng-container *ngIf="filaMediosExtincionExtraordinariosNacionales.size > 0">
        <div class="leyenda-item">
          <img src="/assets/assets/img/ume_logo.png" style="width: 15px" />
        </div>
      </ng-container>
      <ng-container *ngIf="filaMediosExtincionExtraordinariosInternacionales.size > 0">
        <div class="leyenda-item">
          <img src="/assets/assets/img/logo UE.png" style="width: 15px" />
        </div>
      </ng-container>
    </div>

    <!-- Tabla -->
    <table id="tablaHistorico">
      <!--
      <thead>

        <tr>
          <th colspan="24" *ngFor="let entry of filaEvolucion | keyvalue" style="font-size: 10px; text-align: left; color: blue">
            {{ entry.key | date: 'dd-MM-yyyy' }}
          </th>
        </tr>

      </thead>


      <tbody>
        <tr *ngFor="let fila of filas; let i = index" [ngClass]="{ regla: i === 0 }">
          <td *ngFor="let columna of columnas; let j = index" style="border: 1px solid black; text-align: center; padding: 8px">
            <ng-container *ngIf="i !== 0">
              <ng-container *ngIf="j === 0">A{{ i }},{{ j }}</ng-container>
              <ng-container *ngIf="j !== 0">B{{ i }},{{ j }}</ng-container>
            </ng-container>
          </td>
        </tr>
      </tbody>
      -->

      <tbody>
        <tr id="filaDias">
          <td colspan="24" *ngFor="let dia of filaDiasArray" style="font-size: 10px; text-align: left; color: blue">
            {{ dia }}
          </td>
        </tr>

        <!--
        <tr id="filaEvolucion" class="regla" style="height: 20px">
          <ng-container *ngFor="let entry of filaEvolucionDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'filaEvolucion_' + entry.key + '_' + horaIndex"
                class="hora-celda"
                style="position: relative; text-align: center; padding: 8px"
              >
                <div
                  [ngStyle]="{
                    'background-color': getBackgroundColorFilaEvolucion(entry.key, horaIndex),
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '100%',
                    height: '30%',
                  }"
                >
                  {{ horaIndex }}
                </div>
              </td>
            </ng-container>
          </ng-container>
        </tr>
      -->

        <tr id="filaEvolucion" class="regla" style="height: 20px">
          <ng-container *ngFor="let entry of filaEvolucionDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'filaEvolucion_' + entry.key + '_' + horaIndex"
                class="hora-celda"
                [ngClass]="{ 'inicio-dia': horaIndex === 0 }"
                style="position: relative; text-align: center; padding: 8px"
                [attr.title]="
                  'Estado del incendio el ' + entry.key + ' a las ' + horaIndex + ' horas: ' + getEstadoFilaEvolucion(entry.key, horaIndex)
                "
              >
                <div
                  *ngIf="getBackgroundColorFilaEvolucion(entry.key, horaIndex) !== 'transparent'"
                  [ngStyle]="{
                    'background-color': getBackgroundColorFilaEvolucion(entry.key, horaIndex),
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '100%',
                    height: '30%',
                    display: 'block',
                  }"
                >
                  <!--{{ horaIndex }}-->
                </div>
                <div class="tercer-borde"></div>
              </td>
            </ng-container>
          </ng-container>
        </tr>

        <tr id="filaNivelSituacionOperativaEquivalente" style="height: 20px">
          <ng-container *ngFor="let entry of filaNivelSituacionOperativaEquivalenteDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'filaNivelSituacionOperativaEquivalente' + entry.key + '_' + horaIndex"
                class="hora-celda"
                style="position: relative; text-align: center; padding: 8px"
              >
                <div
                  [ngStyle]="{
                    'background-color': getBackgroundColorFilaNivelSituacionOperativaEquivalente(entry.key, horaIndex),
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '100%',
                    height: '30%',
                  }"
                >
                  <!--{{ horaIndex }}-->
                </div>
              </td>
            </ng-container>
          </ng-container>
        </tr>

        <tr id="filaAfectaciones" style="height: 20px">
          <ng-container *ngFor="let entry of filaAfectacionesDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'Afectaciones_' + entry.key + '_' + horaIndex"
                class="hora-celda"
                style="position: relative; text-align: center; padding: 8px"
              >
                <div
                  [ngStyle]="{
                    'background-image': getBackgroundIconFilaAfectaciones(entry.key, horaIndex),
                    'background-size': 'contain',
                    'background-repeat': 'no-repeat',
                    'background-position': 'top center',
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '16px',
                    height: '16px',
                  }"
                >
                  <!--{{ horaIndex }}-->
                </div>
              </td>
            </ng-container>
          </ng-container>
        </tr>

        <tr id="filaMediosExtincionOrdinarios" style="height: 20px">
          <ng-container *ngFor="let entry of filaMediosExtincionOrdinariosDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'filaMediosExtincionOrdinarios' + entry.key + '_' + horaIndex"
                class="hora-celda"
                style="position: relative; text-align: center; padding: 8px"
              >
                <div
                  [ngStyle]="{
                    'background-color': getBackgroundColorFilaMediosExtincionOrdinarios(entry.key, horaIndex),
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '100%',
                    height: '30%',
                  }"
                >
                  <!--{{ horaIndex }}-->
                </div>
              </td>
            </ng-container>
          </ng-container>
        </tr>

        <tr id="filaMediosExtincionExtraOrdinariosNacionales" style="height: 20px">
          <ng-container *ngFor="let entry of filaMediosExtincionOrdinariosNacionalesDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'filaMediosExtincionOrdinarios' + entry.key + '_' + horaIndex"
                class="hora-celda"
                style="position: relative; text-align: center; padding: 8px"
              >
                <div
                  [ngStyle]="{
                    'background-color': getBackgroundColorFilaMediosExtincionExtraordinariosNacionales(entry.key, horaIndex),
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '100%',
                    height: '30%',
                  }"
                >
                  <!--{{ horaIndex }}-->
                </div>
              </td>
            </ng-container>
          </ng-container>
        </tr>

        <tr id="filaMediosExtincionExtraOrdinariosInternacionales" style="height: 20px">
          <ng-container *ngFor="let entry of filaMediosExtincionOrdinariosInternacionalesDiasCompletos | keyvalue; let diaIndex = index">
            <ng-container *ngFor="let hour of [].constructor(24); let horaIndex = index">
              <td
                [id]="'filaMediosExtincionOrdinarios' + entry.key + '_' + horaIndex"
                class="hora-celda"
                style="position: relative; text-align: center; padding: 8px"
              >
                <div
                  [ngStyle]="{
                    'background-color': getBackgroundColorFilaMediosExtincionExtraordinariosInternacionales(entry.key, horaIndex),
                    position: 'absolute',
                    top: '8px',
                    left: '0',
                    width: '100%',
                    height: '30%',
                  }"
                >
                  <!--{{ horaIndex }}-->
                </div>
              </td>
            </ng-container>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>

  <!--
  <mat-card-content *ngIf="dataSource.data.length > 0">
    <div *ngFor="let item of dataSource.data">
      <p>{{ item.fechaHora | date: 'dd-MM-yyyy' }}</p>
    </div>
  </mat-card-content>

  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Estado</th>
        <th>Fecha Evento</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let entry of filaEvolucion | keyvalue">
        <td>{{ entry.key | date: 'dd-MM-yyyy' }}</td>
        <td>{{ entry.value.estado }}</td>
        <td>{{ entry.value.fecha | date: 'dd-MM-yyyy HH:mm' }}</td>
      </tr>
    </tbody>
  </table>
  -->
  <!-- FIN PCD-->
</div>
<br />

<div fxLayout="row" fxLayoutAlign="start stretch" fxLayoutGap="16px" style="height: 100%">
  <div fxFlex="30" class="info-section">
    <mat-card>
      <mat-card-title>Situación Evolutiva</mat-card-title>
      <mat-card-content>
        <p>
          <strong>Inicio de incendio:</strong>
          19/08/2024 19:45
        </p>
        <p>
          <strong>Estado:</strong>
          Activo
        </p>
        <p>
          <strong>Nivel de gravedad:</strong>
          Activo
        </p>
        <mat-divider></mat-divider>

        <h4>Hechos relevantes</h4>
        <p>Activado plan nacional XX (18/08/2024 10:00)</p>
        <p>Activado Copernico (18/08/2024 12:00)</p>
        <p>CECOPI (19/08/2024 18:15)</p>
        <mat-divider></mat-divider>

        <h4>Consecuencias</h4>
        <p>Heridos: 2</p>
        <p>Evacuados: 134 (Santa María - 18/08/2024 19:45)</p>
        <p>Área afectada: Santa María de Guía de Gran Canaria</p>
        <p>Viabilidad: Corte CN-21 PK 2,300-3,100</p>
        <mat-divider></mat-divider>

        <h4>Medios intervinientes</h4>
        <p>BRIF/A - Tineo (18/08/2024 12:40)</p>
        <p>FOCA - Torrejón (18/08/2024 16:35)</p>
        <p>UME - Aprobación (19/08/2024 19:45)</p>
      </mat-card-content>
    </mat-card>
  </div>

  <div fxFlex="70" class="table-section">
    <mat-card>
      <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="16px">
        <mat-card-title>Registro de actualizaciones</mat-card-title>

        <div fxLayout="row" fxLayoutGap="8px" class="btn-container">
          <button mat-button class="circle-button" (click)="goModalEvolution()" appTooltip="Datos evolutivos">E</button>
          <button mat-button class="circle-button" (click)="goModalCoordination()" appTooltip="Dirección y coordinación">C</button>
          <button mat-button class="circle-button" (click)="goModalRelevantActions()" appTooltip="Actuaciones relevantes">R</button>
          <button mat-button class="circle-button" (click)="goModalDocumentation()" appTooltip="Documentación">D</button>
          <button mat-button class="circle-button" (click)="goModalOtherInformation()" appTooltip="Otra información">O</button>
          <button mat-button class="circle-button" (click)="goModalRelatedEvent()" appTooltip="Sucesos relacionados">S</button>
        </div>
      </div>
      <br />
      <mat-card-content *ngIf="dataSource.data.length > 0">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8" style="width: 100%">
          <ng-container matColumnDef="numero">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-center" sortActionDescription="Sort by numero">N°</th>
            <td mat-cell *matCellDef="let element; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>

          <ng-container matColumnDef="fechaHora">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by fechaHora">Fecha / hora</th>
            <td mat-cell *matCellDef="let element">
              {{ getFormatdate(element.fechaHora) }}
            </td>
          </ng-container>

          <ng-container matColumnDef="tipoRegistro">
            <th sortActionDescription="Sort by tipoRegistro" mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de registro</th>
            <td mat-cell *matCellDef="let element">
              {{ element.tipoRegistro }}
            </td>
          </ng-container>

          <ng-container matColumnDef="apartados">
            <th sortActionDescription="Sort by apartados" mat-header-cell *matHeaderCellDef mat-sort-header>Apartados</th>
            <td mat-cell *matCellDef="let element">{{ element.apartados }}</td>
          </ng-container>

          <ng-container matColumnDef="tecnico">
            <th sortActionDescription="Sort by tecnico" mat-header-cell *matHeaderCellDef mat-sort-header class="text-center">Técnico</th>
            <td mat-cell *matCellDef="let element" class="text-center">{{ element.tecnico }}</td>
          </ng-container>

          <ng-container matColumnDef="opciones">
            <th mat-header-cell *matHeaderCellDef style="text-align: center">Opciones</th>
            <td mat-cell *matCellDef="let fire" style="text-align: center">
              <a (click)="goModalEdit(fire)">
                <img src="/assets/img/edit.svg" alt="Editar" appTooltip="Editar registro" />
              </a>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-atom" [fullScreen]="true">
  <p style="color: white">Cargando...</p>
</ngx-spinner>
