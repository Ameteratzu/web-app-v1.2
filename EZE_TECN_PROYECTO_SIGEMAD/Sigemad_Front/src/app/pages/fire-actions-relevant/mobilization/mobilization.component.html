<div class="form-container">
  <form *ngIf="formData" #formDirective="ngForm" [formGroup]="formData" (ngSubmit)="onSubmit(formDirective)">
    <div>
      <h3 class="title"><b>MOVILIZACION DE MEDIOS EXTRAORDINARIOS</b></h3>
      <div class="row" fxLayout="row" fxLayoutGap="30px" fxLayoutAlign="start center">
        <mat-form-field appearance="fill" fxFlex="30%">
          <mat-label>Gestión</mat-label>
          <mat-select [formControl]="getForm('idTipoNotificacion')">
            <mat-option *ngFor="let option of tiposGestion()" [value]="option">
              {{ option.descripcion }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="formData.get('idTipoNotificacion')?.hasError('required')">Este campo es obligatorio.</mat-error>
        </mat-form-field>
      </div>

      <app-step1 *ngIf="getForm('idTipoNotificacion')?.value?.id === 1" [formGroup]="formData" [dataMaestros]="dataMaestros"></app-step1>

      <div class="row add-button-row" fxLayout="row" fxLayoutAlign="end center">
        <button mat-flat-button color="primary" disabled="true">
          <mat-icon>add</mat-icon>
          Agregar
        </button>
      </div>
    </div>
  </form>
  <br />

  <div class="mat-elevation-z8 table-container">
    <table mat-table [dataSource]="dataSource" matSort class="mat-table" style="width: 100%">
      
      <!-- Columna Solicitante -->
      <ng-container matColumnDef="solicitante">
        <th mat-header-cell *matHeaderCellDef>Solicitante / Aportación</th>
        <td mat-cell *matCellDef="let element"> {{ element.solicitante }} </td>
      </ng-container>
  
      <!-- Columna Situación -->
      <!-- <ng-container matColumnDef="situacion">
        <th mat-header-cell *matHeaderCellDef>Situación</th>
        <td mat-cell *matCellDef="let element"> {{ element.situacion }} </td>
      </ng-container> -->
      <ng-container matColumnDef="situacion">
        <th mat-header-cell *matHeaderCellDef>Situación</th>
        <td mat-cell *matCellDef="let element">
          <img src="/assets/img/movilizaciones/m-solicitud.svg" (click)="loadTipo(1)"/>
          <img class="padding-icons" src="/assets/img/movilizaciones/m-tramitacion.svg" (click)="loadTipo(2)"/>
          <img class="padding-icons" src="/assets/img/movilizaciones/m-ofrecimiento.svg" (click)="loadTipo(3)"/>
          <img class="padding-icons" src="/assets/img/movilizaciones/m-aportacion.svg" (click)="loadTipo(5)"/>
          <img class="padding-icons" src="/assets/img/movilizaciones/m-despliegue.svg" (click)="loadTipo(6)"/>
          <img class="padding-icons" src="/assets/img/movilizaciones/m-fin.svg" (click)="loadTipo(7)"/>
          <img class="padding-icons" src="/assets/img/movilizaciones/m-llegada.svg" (click)="loadTipo(8)"/>
        </td>
      </ng-container>
  
      <!-- Columna Última Actualización -->
      <ng-container matColumnDef="ultimaActualizacion">
        <th mat-header-cell *matHeaderCellDef>Ult. actualización</th>
        <td mat-cell *matCellDef="let element"> {{ element.ultimaActualizacion }} </td>
      </ng-container>
  
      <!-- Columna Opciones -->
      <ng-container matColumnDef="opciones">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
          <img src="/assets/img/movilizaciones/m-pasos.svg" alt="edit-btn" />
          <img src="/assets/img/movilizaciones/m-cancelar.svg" alt="edit-btn" />
        </td>
      </ng-container>
  
      <tr mat-header-row *matHeaderRowDef="['solicitante', 'situacion', 'ultimaActualizacion', 'opciones']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['solicitante', 'situacion', 'ultimaActualizacion', 'opciones'];"></tr>
    </table>
  </div>

  <div class="modal-footer" fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="10px">
    <div *ngIf="esUltimo" fxFlex="none">
      <button (click)="delete()" mat-flat-button [style.background-color]="'var(--fire-color)'">Eliminar</button>
    </div>
    <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px" fxFlex="auto">
      <button mat-flat-button color="accent" (click)="closeModal()">Volver</button>
      <button mat-flat-button color="primary" (click)="sendDataToEndpoint()" disabled="true">Guardar</button>
    </div>
  </div>
</div>
