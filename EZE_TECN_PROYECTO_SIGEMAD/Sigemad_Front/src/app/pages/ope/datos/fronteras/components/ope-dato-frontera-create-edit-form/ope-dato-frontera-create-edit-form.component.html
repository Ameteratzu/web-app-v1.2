<h2 mat-dialog-title cdkDrag cdkDragRootElement=".cdk-overlay-pane" cdkDragHandle class="title">
  {{ data.opeDatoFrontera?.id ? 'Modificar' : 'Crear' }} Dato de Frontera
</h2>

<div class="form-container">
  <form [formGroup]="formData" #formDirective="ngForm" (ngSubmit)="onSubmit(formDirective)">
    <mat-dialog-content>
      <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch" class="filter-container">
        <!-- Frontera -->
        <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
          <mat-label>Frontera</mat-label>
          <mat-select [formControl]="getForm('frontera')">
            <mat-option [value]="'Irún'">Irún</mat-option>
            <mat-option [value]="'Otra'">Otra</mat-option>
          </mat-select>
          <mat-error *ngIf="formData.get('frontera')?.hasError('required')">Este campo es obligatorio.</mat-error>
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch" class="filter-container">
        <!-- Fecha y hora de inicio intervalo -->
        <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
          <mat-label>Fecha y hora inicio intervalo</mat-label>
          <input
            matInput
            placeholder="Fecha y hora inicio intervalo"
            formControlName="fechaHoraInicioIntervalo"
            type="datetime-local"
            min="2000-01-01T00:00"
            max="2099-12-31T23:59"
          />
          <mat-error *ngIf="formData.get('fechaHoraInicioIntervalo')?.hasError('required')">Este campo es obligatorio.</mat-error>
          <mat-error *ngIf="formData.get('fechaHoraInicioIntervalo')?.hasError('fechaInvalida')">El valor de la fecha no es válido.</mat-error>
        </mat-form-field>

        <!-- Fecha y hora de fin intervalo -->
        <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
          <mat-label>Fecha y hora fin intervalo</mat-label>
          <input
            matInput
            placeholder="Fecha y hora fin intervalo"
            formControlName="fechaHoraFinIntervalo"
            type="datetime-local"
            min="2000-01-01T00:00"
            max="2099-12-31T23:59"
          />
          <mat-error *ngIf="formData.get('fechaHoraFinIntervalo')?.hasError('required')">Este campo es obligatorio.</mat-error>
          <mat-error *ngIf="formData.get('fechaHoraFinIntervalo')?.hasError('fechaInvalida')">El valor de la fecha no es válido.</mat-error>
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch" class="filter-container">
        <!-- Nº de vehículos -->
        <mat-form-field class="input" fxFlex="50" class="mb-3">
          <mat-label>Nº vehículos</mat-label>
          <input
            matInput
            [formControl]="getForm('numeroVehiculos')"
            type="number"
            required
            (keypress)="utilsService.allowOnlyNumbers($event)"
            min="0"
          />
          <mat-error *ngIf="formData.get('numeroVehiculos')?.hasError('required')">Este campo es obligatorio.</mat-error>
        </mat-form-field>

        <!-- Afluencia -->
        <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
          <mat-label>Afluencia</mat-label>
          <mat-select [formControl]="getForm('afluencia')">
            <mat-option [value]="'Baja'">Baja</mat-option>
            <mat-option [value]="'Media'">Media</mat-option>
            <mat-option [value]="'Alta'">Alta</mat-option>
          </mat-select>
          <mat-error *ngIf="formData.get('afluencia')?.hasError('required')">Este campo es obligatorio.</mat-error>
        </mat-form-field>
      </div>

      <div class="row add-button-row j-end" fxLayout="row" fxLayoutAlign="end center">
        <button mat-flat-button color="primary" type="submit">
          <mat-icon>add</mat-icon>
          Agregar
        </button>
      </div>
    </mat-dialog-content>
  </form>

  <br />

  <div class="mat-elevation-z8 table-container" *ngIf="dataOpeDatosFronteras().length > 0">
    <table mat-table [dataSource]="dataOpeDatosFronteras()" matSort class="mat-table" style="width: 100%">
      <ng-container matColumnDef="fechaHoraInicioIntervalo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha y hora inicio intervalo</th>
        <td mat-cell *matCellDef="let opeDatoFrontera">
          {{ getFechaFormateada(opeDatoFrontera?.fechaHoraInicioIntervalo) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="fechaHoraFinIntervalo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha y hora fin intervalo</th>
        <td mat-cell *matCellDef="let opeDatoFrontera">
          {{ getFechaFormateada(opeDatoFrontera?.fechaHoraFinIntervalo) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="numeroVehiculos">
        <th mat-header-cell *matHeaderCellDef>Nº vehículos</th>
        <td mat-cell *matCellDef="let opeDatoFrontera">
          {{ opeDatoFrontera.numeroVehiculos }}
        </td>
      </ng-container>

      <ng-container matColumnDef="afluencia">
        <th mat-header-cell *matHeaderCellDef>Afluencia</th>
        <td mat-cell *matCellDef="let opeDatoFrontera">
          {{ opeDatoFrontera.afluencia }}
        </td>
      </ng-container>

      <!-- Opciones Column -->
      <ng-container matColumnDef="opciones">
        <th mat-header-cell *matHeaderCellDef>Opciones</th>
        <td mat-cell *matCellDef="let opeDatoFrontera; let i = index">
          <img (click)="seleccionarItem(i)" src="/assets/img/edit-btn.svg" alt="edit-btn" />

          <img (click)="eliminarItem(i)" src="/assets/img/close.svg" alt="doc-btn" />
        </td>
      </ng-container>

      <!-- Header and Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <div class="modal-footer" fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="end center">
    <div fxLayout="row" fxLayoutGap="10px">
      <button (click)="closeModal()" mat-flat-button color="secondary" style="margin-right: 10px">Volver</button>
      <button mat-flat-button color="primary" style="margin-right: 10px" (click)="saveList()">Guardar</button>
    </div>
  </div>
</div>

<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-atom" [fullScreen]="true">
  <p style="color: white">Cargando...</p>
</ngx-spinner>
