<h2 mat-dialog-title cdkDrag cdkDragRootElement=".cdk-overlay-pane" cdkDragHandle class="title">
  {{ data.opeDatoFrontera.id ? 'Modificar' : 'Crear' }} Dato de Frontera {{ data.opeFrontera.nombre }}
</h2>

<form [formGroup]="formData" (ngSubmit)="onSubmit()">
  <mat-dialog-content>
    <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch" class="filter-container">
      <!-- Fecha y hora de inicio intervalo -->
      <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
        <mat-label>Fecha y hora inicio intervalo</mat-label>
        <input
          matInput
          placeholder="Fecha y hora inicio intervalo"
          formControlName="fechaHoraInicioIntervalo"
          type="datetime-local"
          min="2000-01-01T00:00"
          max="2099-12-31T23:59"
          (change)="onFechaHoraChange($event)"
        />
        <mat-error *ngIf="formData.get('fechaHoraInicioIntervalo')?.hasError('required')">Este campo es obligatorio.</mat-error>
        <mat-error *ngIf="formData.get('fechaHoraInicioIntervalo')?.hasError('fechaInvalida')">El valor de la fecha no es válido.</mat-error>
      </mat-form-field>

      <!-- Fecha y hora de fin intervalo -->
      <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
        <mat-label>Fecha y hora fin intervalo</mat-label>
        <input
          matInput
          placeholder="Fecha y hora fin intervalo"
          formControlName="fechaHoraFinIntervalo"
          type="datetime-local"
          min="2000-01-01T00:00"
          max="2099-12-31T23:59"
          (change)="onFechaHoraChange($event)"
        />
        <mat-error *ngIf="formData.get('fechaHoraFinIntervalo')?.hasError('required')">Este campo es obligatorio.</mat-error>
        <mat-error *ngIf="formData.get('fechaHoraFinIntervalo')?.hasError('fechaInvalida')">El valor de la fecha no es válido.</mat-error>
        <mat-error *ngIf="formData.get('fechaHoraFinIntervalo')?.hasError('fechaFinInvalida')">
          La fecha de fin debe ser posterior a la fecha de inicio.
        </mat-error>
      </mat-form-field>
    </div>
    <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="start stretch" class="filter-container">
      <!-- Nº de vehículos -->
      <mat-form-field class="input" fxFlex="50" class="mb-3">
        <mat-label>Nº vehículos</mat-label>
        <input
          matInput
          [formControl]="getForm('numeroVehiculos')"
          type="number"
          required
          (keypress)="utilsService.allowOnlyNumbers($event)"
          min="0"
        />
        <mat-error *ngIf="formData.get('numeroVehiculos')?.hasError('required')">Este campo es obligatorio.</mat-error>
      </mat-form-field>

      <!-- Afluencia -->
      <mat-form-field appearance="fill" fxFlex="50" class="mb-3">
        <mat-label>Afluencia</mat-label>
        <mat-select [formControl]="getForm('afluencia')">
          <mat-option [value]="'Baja'">Baja</mat-option>
          <mat-option [value]="'Media'">Media</mat-option>
          <mat-option [value]="'Alta'">Alta</mat-option>
        </mat-select>
        <mat-error *ngIf="formData.get('afluencia')?.hasError('required')">Este campo es obligatorio.</mat-error>
      </mat-form-field>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="16px" style="width: 100%" class="button-container">
    <!-- Botón Buscar -->
    <button mat-raised-button (click)="closeModal()" color="primary" aria-label="Buscar" class="custom-button" type="button">Cancelar</button>

    <!-- Botón Filtro -->
    <button mat-flat-button color="primary" type="submit" aria-label="Guardar" class="custom-button">Guardar</button>
  </mat-dialog-actions>
</form>

<div class="mat-elevation-z8 table-container" style="padding: 20px">
  <h2 class="fronteras-relacionadas">Fronteras relacionadas</h2>

  <ng-container *ngIf="opeDatosFronterasRelacionados().length == 0"><p>No hay fronteras relacionadas</p></ng-container>
  <table
    mat-table
    *ngIf="opeDatosFronterasRelacionados().length > 0"
    [dataSource]="opeDatosFronterasRelacionados()"
    matSort
    class="mat-table"
    style="width: 100%"
  >
    <!-- Fecha hora inicio intervalo -->
    <ng-container matColumnDef="fechaHoraInicioIntervalo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha hora inicio intervalo</th>
      <td mat-cell *matCellDef="let opeDatoFrontera" [ngClass]="{ datoFronteraActivo: opeDatoFrontera.id === data.opeDatoFrontera.id }">
        {{ getFechaFormateada(opeDatoFrontera.fechaHoraInicioIntervalo) }}
      </td>
    </ng-container>

    <!-- Fecha hora fin intervalo -->
    <ng-container matColumnDef="fechaHoraFinIntervalo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha hora fin intervalo</th>
      <td mat-cell *matCellDef="let opeDatoFrontera" [ngClass]="{ datoFronteraActivo: opeDatoFrontera.id === data.opeDatoFrontera.id }">
        {{ getFechaFormateada(opeDatoFrontera.fechaHoraFinIntervalo) }}
      </td>
    </ng-container>

    <!-- Nº vehículos -->
    <ng-container matColumnDef="numeroVehiculos">
      <th mat-header-cell *matHeaderCellDef>Nº vehículos</th>
      <td mat-cell *matCellDef="let opeDatoFrontera" [ngClass]="{ datoFronteraActivo: opeDatoFrontera.id === data.opeDatoFrontera.id }">
        {{ opeDatoFrontera.numeroVehiculos }}
      </td>
    </ng-container>

    <!-- Afluencia -->
    <ng-container matColumnDef="afluencia">
      <th mat-header-cell *matHeaderCellDef>Afluencia</th>
      <td mat-cell *matCellDef="let opeDatoFrontera" [ngClass]="{ datoFronteraActivo: opeDatoFrontera.id === data.opeDatoFrontera.id }">
        {{ opeDatoFrontera.afluencia }}
      </td>
    </ng-container>

    <!-- Opciones -->
    <ng-container matColumnDef="opciones">
      <th mat-header-cell *matHeaderCellDef>Opciones</th>
      <td
        mat-cell
        *matCellDef="let opeDatoFrontera"
        class="text-center"
        [ngClass]="{ datoFronteraActivo: opeDatoFrontera.id === data.opeDatoFrontera.id }"
      >
        <a (click)="editarDatoFronteraRelacionado(opeDatoFrontera)">
          <img src="/assets/img/edit.svg" alt="Editar" appTooltip="Datos de frontera" />
        </a>
        <a (click)="deleteOpeDatoFrontera(opeDatoFrontera.id)">
          <img src="/assets/img/delete-btn.svg" alt="Borrar" appTooltip="Borrar dato de frontera" />
        </a>
      </td>
    </ng-container>

    <!-- Header and Rows -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</div>

<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-atom" [fullScreen]="true">
  <p style="color: white">Cargando...</p>
</ngx-spinner>
